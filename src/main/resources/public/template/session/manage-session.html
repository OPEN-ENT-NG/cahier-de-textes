<div id="occurrences-creation">
    <!-- Create / Update / View-->
    <div class="cell" ng-class="hasManageVisaRight() ? 'eight' : 'twelve'">
        <div ng-if="!isReadOnly">
            <!-- Create / Update-->
            <form>
                <article>
                    <h3><i18n>utils.subject_and_audience</i18n></h3>
                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>utils.groups</i18n>*

                        </label>
                        <div class="cell twelve-mobile ten">
                            <select required ng-model="session.audience"
                                    ng-disabled="session.courseId && session.subject"
                                    ng-options="group.name for group in structure.audiences.all track by group.id">
                                <option value="" disabled selected>[[translate('creation.groups.choose')]]</option>
                            </select>
                        </div>
                    </div>

                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>subject</i18n>*
                        </label>
                        <div class="cell twelve-mobile ten">
                            <select required ng-model="session.subject"
                                    ng-disabled="session.courseId && session.subject"
                                    ng-options="subject.label for subject in subjects.all track by subject.id">
                                <option value="" disabled selected>[[translate('creation.subject.choose')]]</option>
                            </select>
                        </div>
                    </div>

                    <h3><i18n>session.manage.config</i18n></h3>
                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>title</i18n>*
                        </label>
                        <div class="cell twelve-mobile ten"><input ng-model="session.title"/>
                        </div>
                    </div>
                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>date</i18n>*
                        </label>
                        <div class="cell twelve-mobile ten">
                            <i18n>the</i18n>
                            <date-picker ng-disabled="session.courseId && session.date" ng-model="session.date"></date-picker>
                            <i18n>from2</i18n>
                            <input
                                type="time"
                                ng-disabled="session.courseId && session.startTime"
                                ng-model="session.startTime"
                                required/>
                            <i18n>to2</i18n>
                            <input
                                type="time"
                                ng-disabled="session.courseId && session.endTime"
                                ng-model="session.endTime"
                                required/>
                        </div>
                    </div>

                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>state</i18n>*
                        </label>
                        <div ng-if="session.state == 'draft'" class="cell twelve-mobile ten">
                            <i18n>draft</i18n>
                        </div>
                        <div ng-if="session.state == 'published'" class="cell twelve-mobile ten">
                            <i18n>published</i18n>
                        </div>
                    </div>

                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>utils.room</i18n>
                        </label>
                        <div class="cell twelve-mobile ten"><input ng-model="session.room"/>
                        </div>
                    </div>

                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>utils.description</i18n>
                        </label>
                        <div class="cell twelve-mobile ten">
                            <textarea ng-model="session.description"></textarea>
                        </div>
                    </div>

                    <div class="row form-row">
                        <div class="row">
                            <label class="cell two twelve-mobile">
                                <i18n><i18n>homeworks.attached</i18n></i18n>
                            </label>
                            <!-- Attached homeworks -->
                            <div class="ten cell twelve-mobile ng-scope" >
                                <div class="card row padding-md margin-bottom-md" ng-repeat="homework in session.homeworks">
                                    <div class="row" ng-click="homework.opened = !homework.opened">
                                        <h2 ng-show="!homework.opened" class="hover-orange" style="float: left;">
                                            <i18n>homework</i18n>
                                        </h2>
                                        <h2 ng-hide="!homework.opened" class="hover-orange" style="float: left;">
                                            <i18n>homework</i18n>
                                        </h2>

                                        <div class="cell right-magnet hover-orange">
                                            <i ng-show="!homework.opened" data-tooltip="DÃ©plier" class="down-open"></i>
                                            <i ng-hide="!homework.opened" data-tooltip="Plier" class="up-open ng-hide"></i>
                                        </div>
                                    </div>
                                    <div ng-show="homework.opened">
                                        <div inside-session-form="true" ng-controller="manageHomeworkCtrl"
                                             static-include="/diary/public/template/homework/manage-homework.html" style="padding: 1px;">
                                        </div>
                                    </div>
                                </div>
                                <button ng-click="addHomework()"><i18n>utils.add</i18n></button>
                            </div>
                        </div>

                    </div>

                    <div class="row form-row">
                        <label class="cell two twelve-mobile">
                            <i18n>utils.annotation</i18n>
                        </label>
                        <div class="cell twelve-mobile ten">
                            <textarea ng-model="session.annotation"></textarea>
                        </div>
                    </div>
                </article>

                <div class="row text-right">
                    <div ng-if="session.id" class="left-magnet">
                        <button class="cancel" type="button" ng-click="deleteSession()">
                            <i18n>utils.delete </i18n>
                        </button>
                    </div>
                    <div ng-if="form_is_not_valid" class="warning">
                        <i18n>creation.error</i18n>
                    </div>
                    <button class="float-none display-inline-block cancel" type="button" ng-click="cancelCreation()">
                        <i18n>utils.cancel</i18n>
                    </button>
                    <button class="float-none display-inline-block" ng-disabled="!isValidForm()" type="submit" ng-click="saveSession()">
                        <i18n>utils.save</i18n>
                    </button>

                    <button class="float-none display-inline-block" ng-if="session.state == 'draft'"
                            ng-disabled="!isValidForm()" type="submit"
                            ng-click="publishSession()">
                        <i18n>publish</i18n>
                    </button>
                    <button class="float-none display-inline-block" ng-if="session.state == 'published'"
                            ng-disabled="!isValidForm()" type="submit"
                            ng-click="unpublishSession()">
                        <i18n>unpublish</i18n>
                    </button>
                </div>

            </form>
        </div>

        <!-- View -->
        <div ng-if="isReadOnly">
            <div class="row margin-bottom-md">
                <span class="color-bloc" ng-style="{'background-color': session.color}"></span> &nbsp; <b>[[session.subject.label]] &nbsp; [[session.audience.name]] &nbsp; [[session.teacher.firstName]] [[session.teacher.lastName]]</b>
            </div>
            <div class="row">
                <span class="gray">[[session.startDisplayDate]] &nbsp; [[session.startDisplayTime]] - [[session.endDisplayTime]]</span> &nbsp; <b>[[session.title]]</b>
            </div>
            <div class="read-only-description">
                [[session.description]]
            </div>
        </div>

        <button ng-if="isReadOnly" class="float-none cancel" ng-click="goTo('/');"><i18n>back</i18n></button>
    </div>

    <!-- Visas -->
    <div class="four cell padding-left-md" workflow="diary.manageVisa">
        <div class="card padding-md margin-bottom-md">
            <div ng-if="visaForm.visa">
                <h3 ng-if="!visaForm.visa.id"><i18n>visa.apply.visa</i18n></h3>
                <h3 ng-if="visaForm.visa.id"><i18n>visa.update</i18n></h3>
                <form ng-submit="saveVisa()">
                    <textarea i18n-placeholder="comment" class="resize-vertical min-height-textarea" ng-model="visaForm.visa.comment"></textarea>
                    <div class="row text-center">
                        <button class="display-inline-block float-none cancel four cell" type="button" ng-click="cancelVisaCreateOrUpdate()">
                            <i18n>utils.cancel</i18n>
                        </button>
                        <button class="display-inline-block float-none seven cell" type="submit"><i18n>visa.apply</i18n></button>
                    </div>
                </form>
            </div>
            <button ng-if="!visaForm.visa" class="twelve float-none" ng-click="startCreatingVisa()"><i18n>visa.apply.visa</i18n></button>
        </div>
        <div class="card padding-md">
            <h3 class="remove-margin">Visas</h3>
            <table ng-if="session.visas.length > 0" class="twelve remove-margin">
                <tbody>
                <tr ng-repeat="visa in session.visas | orderBy : '-moment'" class="show-i-hover" ng-class="{'visa-being-updated': visa.isBeingUpdated}">
                    <td>
                        <div class="row">
                            <div class="ten cell ">
                                <div class="six cell twelve-tablet">[[visa.displayDateTime]]</div>
                                <div class="six cell twelve-tablet">[[visa.owner.lastName]] [[visa.owner.firstName]]</div>
                            </div>
                            <div class="two cell edit-visa-icons" >
                                <i class="six cell twelve-tablet" ng-click="startUpdatingVisa(visa)">&#xe806;</i>
                                <i class="six cell twelve-tablet" ng-click="deleteVisa(visa)">&#xe8cf;</i>
                            </div>
                        </div>
                        <div class="row">
                            <b><i18n>comment</i18n>: </b> [[visa.comment]]
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
            <div ng-if="session.visas.length === 0" class="sub-text text-center"><i18n>visa.none.applied</i18n></div>
        </div>
    </div>
</div>