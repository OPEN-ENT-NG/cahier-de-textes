<h1><a href="#" ng-click="showCalendar()"><i18n>diary.title</i18n>&nbsp;-&nbsp;<i18n>diary.lesson.label</i18n></a></h1>
<form name="lessonform">
    <div class="row">
        <div class="cell" style="width: 21em">
            <item-picker ng-model="lesson.subject" ng-change="loadPreviousLessonsFromLesson(lesson);"></item-picker>
        </div>
        <div class="three cell">
            <select ng-model="lesson.audience" ng-change="refreshHomeworkLoads(lesson); loadPreviousLessonsFromLesson(lesson);"
                    ng-options="audience as audience.name group by audience.typeLabel for audience in audiences.all"
            ></select>
        </div>
    </div>

    <section class="tabs row">
        <headerHomeworkLesson ng-class="{ selected: tabs.createLesson === 'lesson' }"
                              ng-click="tabs.createLesson = 'lesson'">
            <i18n>create.lesson.tabs.lesson</i18n>
        </headerHomeworkLesson>
        <headerHomeworkLesson ng-class="{ selected: tabs.createLesson === 'homeworks' }"
                              ng-click="tabs.createLesson = 'homeworks';">
            <i18n>create.lesson.tabs.homeworks</i18n>
        </headerHomeworkLesson>
        <headerHomeworkLesson ng-class="{ selected: tabs.createLesson === 'previouslessons' }"
                              ng-click="displayPreviousLessonsTabAndLoad(lesson);">
            <i18n>create.lesson.tabs.previouslessons</i18n>
        </headerHomeworkLesson>

        <section ng-show="tabs.createLesson === 'lesson'">
            <div class="row">
                <input type="text" i18n-placeholder="title" ng-model="lesson.title" maxlength="50" required class="six cell" />

                <!--ng-model="lesson.teacher"-->
                <div class="cell right-magnet">
                    <input type="color" ng-model="lesson.color">
                </div>

            </div>
            <div class="row">
                <!-- Beginning (Date: DD/MM/YYYY) -->
                <div class="three cell">
                    <label class="cell three"><i18n>date</i18n></label>
                    <date-picker ng-model="newItem.date"  class="cell six"></date-picker>
                </div>

                <!-- Beginning (Time: HH:mm) -->
                <div class="three cell">
                    <label class="cell four"><i18n>start.time</i18n></label>
                    <time-picker ng-model="newItem.beginning" class="cell four"></time-picker>
                </div>

                <!-- End (Time: HH:mm) -->
                <div class="three cell">
                    <label class="cell four"><i18n>end.time</i18n></label>
                    <time-picker ng-model="newItem.end" class="cell four"></time-picker>
                </div>
                <div class="two cell">
                    <label class="cell five"><i18n>room</i18n></label>
                    <input type="text" i18n-placeholder="room" ng-model="lesson.room" maxlength="8" class="cell six" />
                </div>

            </div>
            <div class="row">
                <editor ng-model="lesson.description"></editor>
            </div>
            <div class="row accordions">
                <article class="accordion" ng-class="{ opened: tabs.showAnnotations }">
                    <h2 ng-click="tabs.showAnnotations = !tabs.showAnnotations">
                        <i18n>annotations.title</i18n>
                    </h2>
                    <div class="toggle">
                        <editor ng-model="lesson.annotations"></editor>
                    </div>
                </article>
            </div>
        </section>






        <!-- HOMEWORK(S) ATTACHED TO LESSON -->
        <section ng-show="tabs.createLesson === 'homeworks'">
            <div class="row" ng-repeat="homework in lesson.homeworks.all">

                <!-- minimized view -->
                <div class="row">
                    <div>
                        <ul>
                            <li>
                                <i class="lesson_homework" ng-class="{ expanded: homework.expanded}" ng-click="toggleShowHomeworkInLesson(homework)" tooltip="diary.icon.show.homework"></i>
                            </li>
                        </ul>
                    </div>
                    <div ng-show="!homework.expanded" class="four cell">
                        <b><i18n>daily.homework.givenduedate</i18n> [[formatDate(homework.dueDate)]]</b><br>
                        [[homework.type.label]] - [[homework.title]]
                    </div>
                </div>

                <div ng-show="homework.expanded">
                    <div class="row">
                        <input ng-if="!isLessonHomeworkEditable" type="text" ng-model="homework.title" i18n-placeholder="title" maxlength="50" class="six cell" readonly/>
                        <input ng-if="isLessonHomeworkEditable" type="text" ng-model="homework.title" i18n-placeholder="title" maxlength="50" class="six cell"/>
                        <!-- deletes homework -->
                        <div class="controls">
                            <i ng-if="isLessonHomeworkEditable" class="trash" ng-click="showConfirmPanel('confirm-delete-homeworklesson', homework)" style="float: right;" tooltip="daily.homework.delete">
                            </i>
                        </div>
                    </div>
                    <div class="row">
                        <div class="four cell">
                            <label class="four cell"><i18n>homework.date</i18n></label>
                            <input ng-if="!isLessonHomeworkEditable" type="text" class="five cell" value="[[formatDate(homework.dueDate)]]" readonly/>
                            <date-picker ng-if="isLessonHomeworkEditable" ng-change="showHomeworksLoad(homework, homework.dueDate.getTime())" class="five cell" ng-model="homework.dueDate"></date-picker>
                        </div>
                        <div class="five cell">
                            <label class="three cell"><i18n>homework.type</i18n></label>
                            <select ng-if="!isLessonHomeworkEditable"
                                    class="seven cell"
                                    ng-options="type as type.label for type in homeworkTypes.all"
                                    ng-model="homework.type"
                                    disabled></select>

                            <select ng-if="isLessonHomeworkEditable"
                                    class="seven cell"
                                    ng-options="type as type.label for type in homeworkTypes.all"
                                    ng-model="homework.type"></select>
                        </div>
                    </div>
                    <div>
                    <span ng-repeat="homeworkLoad in homework.weekhomeworksload">
                        <span class="homeworksDayLoad" tooltip="[[homeworkLoad.description]]"
                              ng-class="{ 'red': isHighHomeworkLoad(homeworkLoad), 'yellow': isMediumHomeworkLoad(homeworkLoad), 'green': isLowHomeworkLoad(homeworkLoad) }">
                            [[homeworkLoad.day]] [[homeworkLoad.numDay]]</span>
                    </span>
                    </div>
                    <div class="row">
                        <div ng-if="!isLessonHomeworkEditable" ng-bind-html="homework.description" class="lessonHomeworkDescription"></div>
                        <editor ng-if="isLessonHomeworkEditable" ng-model="homework.description"></editor>
                    </div>
                </div>
                <hr class="homework-delimitation">
            </div>
            <div ng-if="isLessonHomeworkEditable" class="row">
                <i class="add-icon" ng-class="" ng-click="addHomeworkToLesson(lesson)" tooltip="lesson.homeworks.add"></i>
            </div>
        </section>


        <!-- PREVIOUS LESSONS CREATED -->
        <section ng-show="tabs.createLesson === 'previouslessons'">
            <div ng-show="!lesson.previousLessons || lesson.previousLessons.length === 0">
                <i18n>daily.lesson.nopreviouslesson</i18n>
            </div>

            <div class="row" ng-repeat="pedagogicItem in lesson.previousLessonsDisplayed" overflow-y="scroll"  bottom-scroll="showMorePreviousLessons(lesson)">
                <div style="background-color: #2a9cc8; color: white; padding-left: 5px;">
                    [[pedagogicItem.dayFormatted]] - [[pedagogicItem.start_hour]] - [[pedagogicItem.end_hour]] - [[pedagogicItem.audience]]
                </div>
                <div>
                    <!-- LESSON DESCRIPTION -->
                    <div style="float: left; width: 50%;">
                        <div><span><b><i18n>daily.lesson.previous.label</i18n></b></span> [[pedagogicItem.title]]</div>
                        <span class="inline"
                              style="[[(pedagogicItem.description.length >= pedagogicItem.descriptionMaxSize) ? 'cursor:pointer' : 'cursor:default' ]]"
                              ng-click="pedagogicItem.expanded_description = !pedagogicItem.expanded_description">
                                <span ng-show="!pedagogicItem.expanded_description">
                                     <span bind-html="pedagogicItem.preview_description"></span>
                                </span>
                                <span ng-show="pedagogicItem.expanded_description">
                                     <span bind-html="pedagogicItem.description"></span>
                                </span>
                            </span>
                    </div>

                    <!-- ATTACHED HOMEWORKS-->
                    <div style="float: right; width: 50%;">
                        <div class="row" ng-repeat="homework in pedagogicItem.homeworks">
                            <b><i18n>homework.date</i18n> [[homework.dayFormatted]]</b><br>
                            [[homework.title]]<br>
                            <span class="inline"
                                  style="[[(homework.description.length >= homework.descriptionMaxSize) ? 'cursor:pointer' : 'cursor:default' ]]"
                                  ng-click="homework.expanded_description = !homework.expanded_description">
                                <span ng-show="!homework.expanded_description">
                                     <span bind-html="homework.preview_description"></span>
                                </span>
                                <span ng-show="homework.expanded_description">
                                     <span bind-html="homework.description"></span>
                                </span>
                            </span>
                            <br>
                        </div>
                    </div>
                </div>
                <br>
            </div>

            <!-- Scroll bar to see more previous lessons -->
            <div class="showMoreLessonsBar"
                 ng-if="lesson.previousLessonsDisplayed.length < lesson.previousLessons.length" ng-click="showMorePreviousLessons(lesson)">
                Voir plus de séances précédentes
            </div>
        </section>


        <div class="row lessonHomeworkBtn">
            <nav>
                <!-- publishes the current lesson ang go back to calendar view -->
                <button ng-if="lesson.id && lesson.state == 'draft'" class="right-magnet" type="submit"  data-ng-click="lessonform.$valid && publishLessonAndGoCalendarView(lesson, true)">
                    <i18n>daily.item.publish</i18n>
                </button>

                <!-- share -->
                <button class="right-magnet" ng-click="openShareLessonPanel(lesson)" >
                    <i18n>share</i18n>
                </button>

                <!-- un-publishes the current lesson (back to draft mode) and go back to calendar view -->
                <button ng-if="lesson.id && lesson.state == 'published'" class="right-magnet" type="submit"  data-ng-click="lessonform.$valid && publishLessonAndGoCalendarView(lesson, false)">
                    <i18n>daily.item.unpublish</i18n>
                </button>

                <!-- save lesson in draft mode -->
                <button class="right-magnet" type="submit" data-ng-click="lessonform.$valid && createOrUpdateLesson(false)">
                    <i18n>save</i18n>
                </button>

                <!-- save lesson in draft mode and go back to calendar view -->
                <button class="right-magnet" type="submit" data-ng-click="lessonform.$valid && createOrUpdateLesson(true)">
                    <i18n>back</i18n>
                </button>

                <!-- go back to calendar view without saving -->
                <button class="right-magnet cancel" type="button" ng-click="redirect('/mainView')">
                    <i18n>cancel</i18n>
                </button>
            </nav>
        </div>
    </section>
</form>